# 번역 자동 견적 시스템 — 구현 기획안 (Final)

> **Tech Stack:** Python + OpenAI API (GPT-4o-mini) + Streamlit + Google Sheets  
> **Date:** 2026. 02.

---

## 1. 프로젝트 개요

본 기획안은 번역 회사의 핵심 반복 업무인 '주문 접수 → 견적 발송' 프로세스를 자동화하는 시스템입니다. 웹에서 사용자가 직접 정보를 입력하면 즉시 견적을 확인하고 PDF 견적서까지 다운로드할 수 있습니다.

### 1.1 핵심 구조

| 구분 | 내용 |
|------|------|
| **사용자 경험** | 웹 접속 → 정보 입력 → 즉시 견적 확인 (30초) |
| **LLM** | OpenAI GPT-4o-mini (이메일 파싱, 파일 난이도 분석) |
| **견적 산출** | 사용자 입력 기반 rule-based 실시간 자동 산출 |
| **이메일 파싱** | 보조 모듈 — 파싱 결과를 웹 폼에 자동 사전입력(Pre-fill) |

> ⚠️ **프로덕션 보안 주석**  
> 현재는 리소스 부족으로 OpenAI API를 사용하지만, 실제 서비스 환경에서는 번역 원문(저작물)이 외부 API로 전송되어 유출될 위험이 있습니다. 프로덕션에서는 반드시 로컬 LLM(Ollama + Mistral 7B 등)으로 전환하여 원문이 외부 서버로 전송되지 않도록 해야 합니다.

---

## 2. 시스템 아키텍처

### 2.1 전체 플로우

**메인 플로우: 웹 기반 실시간 견적**

```
① 고객이 견적 페이지에 접속 (웹 브라우저)
② 번역 요건 입력: 언어쌍, 분야, 분량, 납기일, 할증 옵션
③ (선택) 파일 업로드 → GPT-4o-mini가 분량/언어/난이도 자동 분석
④ 단가표 기반 실시간 견적 산출 → 화면에 즉시 표시
⑤ 고객이 견적 확인 → PDF 견적서 다운로드
⑥ 견적 데이터 Google Sheets에 자동 기록 (관리용)
```

**보조 플로우: 이메일 파싱 → 웹 사전입력**

```
① 고객이 이메일로 번역 요청 발송 (기존 방식)
② 시스템이 이메일 수신 → GPT-4o-mini로 파싱 → JSON 추출
③ 파싱 결과를 견적 웹 페이지에 자동 사전입력 (Pre-fill)
④ 담당자가 웹에서 확인/수정 → 견적 확정 → 회신
```

### 2.2 기술 스택

| 레이어 | 현재 (개발/테스트) | 프로덕션 전환 시 |
|--------|-------------------|-----------------|
| **프론트엔드** | Streamlit | Streamlit 또는 React |
| **LLM** | OpenAI GPT-4o-mini | 로컬 LLM (주석 참고) |
| **견적 엔진** | Python rule-based | 동일 (LLM 불필요) |
| **PDF 생성** | ReportLab | 동일 |
| **데이터 저장** | Google Sheets (gspread) | Google Sheets + DB |

> ```python
> # ──────────────────────────────────────────────────────
> # ⚠️ TODO [프로덕션 전환 시]
> # 현재: OpenAI API (GPT-4o-mini) 사용 — 리소스 부족으로 로컬 LLM 미사용
> # 프로덕션: 로컬 LLM 필수 전환 (원문 유출 방지)
> #   - 프레임워크: Ollama 또는 vLLM
> #   - 모델: Mistral 7B-Instruct / Llama 3 8B
> #   - 엔드포인트: http://localhost:11434/api/generate
> #   - OpenAI-compatible API이므로 코드 변경 최소화 가능
> #   - 파일 분석 서버: 인터넷 아웃바운드 차단 (방화벽)
> # ──────────────────────────────────────────────────────
> ```

---

## 3. 웹 견적 페이지 상세 설계 (핵심 모듈)

### 3.1 사용자 입력 필드

| 필드 | 타입 | 설명 | UI 컴포넌트 |
|------|------|------|-------------|
| **고객명** | text | 고객명 또는 회사명 | 텍스트 입력 |
| **이메일** | email | 견적서 발송용 이메일 | 이메일 입력 |
| **언어쌍** | select | 원문→번역 언어 (8개 쌍) | 드롭다운 선택 |
| **분야** | select | 일반/법률/의료/기술 | 드롭다운 선택 |
| **분량** | number | 숫자 + 단위 (글자/단어/페이지) | 숫자입력 + 단위 드롭다운 |
| **납기일** | date | 요청 납기일 | 날짜 선택기 |
| **할증 옵션** | checkbox | 긴급/준긴급/DTP/야간 (복수선택) | 토글 버튼 그룹 |
| **파일 업로드** | file | (선택) 원문 파일 → 자동분석 | 드래그앤드롭 |
| **특이사항** | textarea | 추가 요청사항 | 텍스트 영역 |

### 3.2 실시간 견적 산출 로직

사용자가 필드를 변경할 때마다 즉시 재계산됩니다. 견적 계산 자체는 LLM 호출 없이 rule-based로 처리하므로 지연이 없습니다.

```
① 분량 환산 (글자수 기준 통일)
   - 글자 수 → 그대로
   - 단어 수 → × 2.5 (평균 한 단어 ≈ 2.5자)
   - 페이지 수 → × 300 (300자/페이지 기준)

② 기본 금액 = 환산 글자수 × 글자당 단가 (언어쌍 + 분야별)

③ 할증 적용 = 기본금액 × (1 + 각 할증률의 합)
   - 긴급(24h): +50%  |  준긴급(48h): +30%
   - DTP(서식유지): +20%  |  야간/주말: +10%
   - ※ 긴급/준긴급은 상호 배타

④ 최종 견적 = 할증 적용 금액 + VAT(10%)
```

### 3.3 단가표

| 언어쌍 | 일반 (원/자) | 법률/의료 (원/자) | 기술/IT (원/자) |
|--------|:------------:|:-----------------:|:---------------:|
| **한 → 영** | 120 | 180 / 200 | 160 |
| **영 → 한** | 110 | 170 / 190 | 150 |
| **한 → 일** | 130 | 200 / 220 | 180 |
| **한 → 중** | 100 | 160 / 180 | 140 |

**할증 체계:**

| 할증 항목 | 조건 | 할증률 |
|-----------|------|:------:|
| 긴급 할증 | 납기 24시간 이내 | +50% |
| 준긴급 할증 | 납기 48시간 이내 | +30% |
| DTP 할증 | 원본 서식 유지 필요 | +20% |
| 야간/주말 | 업무시간 외 납품 | +10% |

### 3.4 화면 구성 (2-Step UI)

**Step 1 | 정보 입력** — 고객 정보, 번역 요건, 할증 옵션, 특이사항을 섹션별 카드 UI로 구성. 파일 업로드 시 GPT-4o-mini가 분량/언어/분야를 자동 감지하여 필드를 Pre-fill. 필수 필드 완료 시 '견적 산출하기' 버튼 활성화.

**Step 2 | 견적 결과** — 견적서 번호, 발행일, 수신자 정보 상단 표시. 견적 상세(단가, 분량, 할증 내역, 소계) 항목별 표시. 최종 금액(VAT 포함) 강조. 'PDF 다운로드' 및 '새 견적 작성' 버튼.

### 3.5 파일 업로드 시 자동 분석

파일 업로드는 선택사항이지만, 업로드 시 분량 입력을 자동화합니다.

```
① 파일 포맷 감지: docx / pdf / txt / hwp
② 텍스트 추출: python-docx, PyPDF2, pdfplumber 등
③ 분량 계산: 글자수(한국어) / 단어수(영문) 자동 카운트
④ 언어 감지: langdetect 라이브러리
⑤ 난이도 분석: GPT-4o-mini로 샘플 텍스트(첫 500자) 분석 → 분야 판별
⑥ 자동 입력: 분석 결과를 웹 폼에 Pre-fill
```

> ```python
> # ──────────────────────────────────────────────────────
> # ⚠️ SECURITY NOTE
> # 현재: OpenAI GPT-4o-mini로 파일 분석 (개발/테스트용)
> #       리소스 부족으로 로컬 LLM 미사용
> #
> # TODO [프로덕션 전환 시]
> # 번역 원문을 외부 API로 전송하면 저작물 유출 위험이 있으므로
> # 실제 서비스에서는 반드시 로컬 LLM으로 전환해야 합니다.
> #   - Ollama + Mistral 7B (http://localhost:11434)
> #   - 파일 분석 서버 인터넷 아웃바운드 차단
> #   - OpenAI-compatible API → 코드 변경 최소
> #
> # 현재 개발 단계에서는 실제 고객 원문 대신
> # 더미 데이터로 테스트합니다.
> # ──────────────────────────────────────────────────────
> ```

### 3.6 PDF 견적서 구성

| 섹션 | 포함 내용 |
|------|-----------|
| **헤더** | 회사 로고, 회사명, 연락처, 견적서 번호 (Q-YYYYMMDD-###), 발행일 |
| **고객 정보** | 수신: 고객명/회사명, 이메일 |
| **견적 상세** | 언어쌍, 분야, 분량(환산 글자수), 글자당 단가, 기본금액, 할증 내역 |
| **합계** | 소계, VAT(10%), 총 견적금액 |
| **부가 정보** | 납기일, 결제조건(납품 후 30일), 유효기간(발행일+7일), 특이사항 |

---

## 4. 이메일 파싱 에이전트 (보조 모듈)

기존 방식(이메일)으로 들어오는 요청을 GPT-4o-mini로 파싱하여 웹 견적 페이지에 자동 사전입력합니다.

### 4.1 파싱 대상 필드

| 필드 | 타입 | 설명 | 추출 예시 |
|------|------|------|-----------|
| **client_name** | string | 고객명/회사명 | "ABC무역 김민수" |
| **source_lang** | ISO 639-1 | 원문 언어 | "ko" |
| **target_lang** | ISO 639-1 | 번역 대상 언어 | "en" |
| **volume** | object | 분량 | {"value":15, "unit":"pages"} |
| **deadline** | ISO 8601 | 납기일 | "2026-02-20T18:00" |
| **domain** | enum | 분야 | "legal" |
| **urgency** | enum | 긴급도 | "urgent" |
| **notes** | string | 특이사항 | "표 포함, 서식 유지" |

### 4.2 프롬프트 설계

**원칙 1 | 역할 부여:** '번역 PM'으로서 고객 이메일을 분석하라고 명시.

**원칙 2 | 출력 스키마 고정:** JSON Schema를 프롬프트에 포함, 동일 구조 응답 강제. 누락 필드는 null.

**원칙 3 | Few-shot 예시:** 다양한 패턴의 이메일 3~5개와 JSON 출력 쌍 포함.

> ```python
> # ──────────────────────────────────────────────────────
> # 이메일 파싱 보안 참고
> # 이메일 파싱은 '요청 메타데이터'만 처리하므로 외부 API 사용 가능.
> # 단, 이메일 본문에 번역 원문이 직접 포함된 경우:
> #   → 원문 부분을 마스킹 처리 후 API 전송
> #   → 또는 프로덕션에서 로컬 LLM으로 전환
> # 첨부파일 내용은 외부 API로 전송하지 않음.
> # ──────────────────────────────────────────────────────
> ```

---

## 5. End-to-End 테스트 시나리오

### 5.1 테스트 A: 웹 직접 입력 → 일반 견적

**입력:**

```
사용자: ABC무역 김민수
언어쌍: 한국어 → 영어
분야: 일반
분량: 4,500자
납기: 2026-02-20
할증: DTP (서식 유지) +20%
특이사항: 표와 그래프 원본 서식 유지
```

**예상 결과:**

| 항목 | 분량 | 단가 | 할증 | 금액 |
|------|:----:|:----:|:----:|-----:|
| 한→영 일반 번역 | 4,500자 | 120원/자 | - | 540,000원 |
| DTP (서식 유지) | - | - | +20% | 108,000원 |
| **소계** | | | | **648,000원** |
| VAT (10%) | | | | 64,800원 |
| **총 견적금액** | | | | **712,800원** |

### 5.2 테스트 B: 이메일 → 파싱 → Pre-fill → 긴급 견적

**테스트 이메일:**

```
From: lee@lawfirm.co.kr
Subject: 급한 번역 부탁드립니다

이 변호사입니다. 내일 오전까지 급하게 필요한 게 있어서요.
첨부 계약서 영문번역 부탁드립니다.
법률 용어 정확하게 해주셔야 합니다. 분량은 8페이지 정도요.
```

**파싱 → Pre-fill:**

| 웹 폼 필드 | 자동 입력 값 |
|------------|-------------|
| 고객명 | 이 변호사 (lee@lawfirm.co.kr) |
| 언어쌍 | 한국어 → 영어 |
| 분야 | 법률 |
| 분량 | 8페이지 = 2,400자 |
| 할증 | 긴급 +50% ('내일 오전' 감지) |

**예상 결과:**

| 항목 | 분량 | 단가 | 할증 | 금액 |
|------|:----:|:----:|:----:|-----:|
| 한→영 법률 번역 | 2,400자 | 180원/자 | - | 432,000원 |
| 긴급 할증 (24h) | - | - | +50% | 216,000원 |
| **소계** | | | | **648,000원** |
| VAT (10%) | | | | 64,800원 |
| **총 견적금액** | | | | **712,800원** |

### 5.3 검증 체크리스트

| # | 검증 항목 | 통과 기준 |
|:-:|-----------|-----------|
| 1 | 웹 입력 → 견적 산출 | 필드 입력 후 견적 즉시 표시 (1초 이내) |
| 2 | 실시간 재계산 | 할증 변경 시 금액 즉시 반영 |
| 3 | 견적 금액 정확성 | 수동 계산 결과와 완전 일치 |
| 4 | 할증 상호 배타 | 긴급/준긴급 동시 선택 시 하나만 유지 |
| 5 | PDF 견적서 | 정상 열림, 모든 필드 정확 |
| 6 | 이메일 파싱 → Pre-fill | 10개 테스트 이메일 필수필드 추출 90%+ |
| 7 | 파일 분량 분석 | 실제 글자수 대비 ±5% |
| 8 | Google Sheets 기록 | 견적 확정 시 시트에 자동 저장 |
| 9 | E2E 소요 시간 | 입력 → PDF 다운로드 30초 이내 |

---

## 6. 구현 일정 (5일)

| 일차 | 작업 내용 | 산출물 |
|:----:|-----------|--------|
| **Day 1** | 웹 견적 UI (Streamlit) + 단가표/견적 계산 로직 | app.py, pricing.json, quote_calculator.py |
| **Day 2** | PDF 견적서 생성 + Google Sheets 연동 | pdf_generator.py, sheets_connector.py |
| **Day 3** | 파일 분석 엔진 (GPT-4o-mini) + 분량/언어 감지 | file_analyzer.py |
| **Day 4** | 이메일 파싱 모듈 + 웹 Pre-fill 연동 | email_parser.py, prompts.py |
| **Day 5** | E2E 테스트 + 문서화 + 프롬프트 개선 기록 | test_e2e.py, flowchart, prompt_iteration.md |

---

## 7. 프로젝트 구조

```
translation-quote-system/
├── app.py                    # Streamlit 메인 (웹 견적 페이지)
├── modules/
│   ├── quote_calculator.py   # 견적 산출 (rule-based, LLM 불필요)
│   ├── file_analyzer.py      # 파일 분석 (GPT-4o-mini / ⚠️ 프로덕션: 로컬 LLM)
│   ├── email_parser.py       # 이메일 파싱 (GPT-4o-mini)
│   ├── pdf_generator.py      # PDF 견적서 생성
│   └── sheets_connector.py   # Google Sheets 연동
├── config/
│   ├── pricing.json          # 단가표 (언어쌍 × 분야)
│   └── prompts.py            # LLM 프롬프트 관리
├── templates/
│   └── quote_template.py     # PDF 템플릿
├── tests/
│   ├── test_emails/          # 테스트 이메일 10종
│   ├── test_files/           # 테스트 번역 파일 (더미)
│   └── test_e2e.py           # E2E 테스트
├── docs/
│   ├── flowchart.md          # 시스템 플로우
│   └── prompt_iteration.md   # 프롬프트 개선 기록
├── requirements.txt
└── README.md
```

### 7.1 코드 내 보안 주석

**file_analyzer.py:**

```python
"""
파일 분석 모듈 (File Analyzer)

현재: OpenAI GPT-4o-mini 사용 (리소스 부족으로 로컬 LLM 미사용)

⚠️ TODO [프로덕션 전환 시]
번역 원문(저작물)을 외부 API로 전송하면 유출 위험이 있으므로
실제 서비스에서는 반드시 로컬 LLM으로 전환해야 합니다.
  - Ollama + Mistral 7B: http://localhost:11434/api/generate
  - OpenAI-compatible API이므로 base_url만 변경하면 됨
  - 파일 분석 서버 인터넷 아웃바운드 차단 필수

현재 개발 단계에서는 실제 고객 원문 대신 더미 데이터로 테스트합니다.
"""

import openai

client = openai.OpenAI()
# TODO [프로덕션]: 아래로 교체
# client = openai.OpenAI(base_url="http://localhost:11434/v1")

response = client.chat.completions.create(
    model="gpt-4o-mini",  # TODO [프로덕션]: "mistral:7b-instruct"
    messages=[...],
)
```

**quote_calculator.py:**

```python
"""
견적 산출 엔진 (Quote Calculator)

견적 계산은 rule-based 로직으로 처리합니다.
LLM 호출이 필요 없으므로 보안 이슈 없음.
단가표는 config/pricing.json에서 관리.
"""
```

---

## 8. 리스크 및 대응

| # | 리스크 | 영향 | 대응 |
|:-:|--------|------|------|
| 1 | 원문 유출 (외부 API) | 저작권 침해 | 프로덕션 시 로컬 LLM 전환 (코드 주석 준비 완료) |
| 2 | GPT-4o-mini 응답 지연 | 파일 분석 속도 저하 | rule-based fallback (글자수/언어는 LLM 없이 가능) |
| 3 | PDF 텍스트 추출 실패 | 분량 자동 분석 불가 | 수동 입력 UI 제공 |
| 4 | 이메일 파싱 불일치 | Pre-fill 오류 | 담당자 확인 단계 필수, confidence score |
| 5 | 단가표 변경 반영 지연 | 구버전 단가 적용 | pricing.json 버전 관리 |

---

## 9. 포트폴리오 문서화 전략

**① 설계 순서도:** Mermaid로 '웹 입력 → 견적 산출 → PDF' 메인 플로우와 '이메일 → 파싱 → Pre-fill' 보조 플로우 시각화.

**② 보안 설계 의식:** 코드 곳곳에 프로덕션 전환 주석을 남겨, 현재 리소스 한계를 인지하면서도 실서비스 보안 설계를 고려하고 있음을 보여줌.

**③ 프롬프트 이터레이션:** 초기 프롬프트 → 실패 사례 → 개선 과정 기록. 구체적 예시: v1 날짜 추출 실패 → v2 현재 날짜 컨텍스트 추가.

**④ 실패→개선 기록:** Git commit 히스토리 + README Known Issues & Improvements 섹션.